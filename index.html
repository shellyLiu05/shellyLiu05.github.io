<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>shellyLiu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="shellyLiu">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="shellyLiu">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="shellyLiu">
  
    <link rel="alternate" href="/atom.xml" title="shellyLiu" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">shellyLiu</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-mysql备份" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/01/mysql备份/" class="article-date">
  <time datetime="2018-08-01T09:24:50.000Z" itemprop="datePublished">2018-08-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/01/mysql备份/">mysql备份与恢复</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="备份目的"><a href="#备份目的" class="headerlink" title="备份目的"></a>备份目的</h2><p>为了在意外情况下（服务器崩溃，误操作，黑客攻击等）保证数据不丢失。</p>
<h2 id="备份需要考虑的因素"><a href="#备份需要考虑的因素" class="headerlink" title="备份需要考虑的因素"></a>备份需要考虑的因素</h2><ol>
<li>是否需要停止MySQL服务器</li>
<li>备份过程的时长</li>
<li>备份对client增删改查的影响</li>
<li>备份时服务器的负载</li>
<li>备份数据的存储类型，占用空间，是否支持压缩，存储文件是否直观可读</li>
<li>备份过程中是否需要锁定资源，锁定的时间</li>
<li>备份周期</li>
<li>备份策略</li>
<li>恢复过程的时长</li>
<li>备份文件的可用性</li>
</ol>
<h2 id="备份类型"><a href="#备份类型" class="headerlink" title="备份类型"></a>备份类型</h2><h3 id="物理备份VS逻辑备份"><a href="#物理备份VS逻辑备份" class="headerlink" title="物理备份VS逻辑备份"></a>物理备份VS逻辑备份</h3><p><strong>物理备份</strong></p>
<p>由存储数据库内容的目录和文件的原始副本组成。</p>
<p>适用于大型、重要、当问题出现时需要迅速恢复的数据库。</p>
<p>特性：</p>
<ol>
<li>比逻辑备份速度快</li>
<li>备份可以在MySQL服务器不运行时执行。如果服务器正在运行，则必须执行适当的锁定，以便服务器在备份期间不更改数据库内容。</li>
<li>备份文件比逻辑备份更简洁</li>
<li>备份文件可以包括log和配置文件</li>
<li>备份只对具有相同或类似硬件特性的其他机器具有可移植性。</li>
<li>备份和还原粒度是数据目录级别到单个文件级别，是否提供table级粒度依赖于存储引擎</li>
</ol>
<p><strong>逻辑备份</strong></p>
<p>将信息保存为逻辑数据库结构（CREATE DATABASE, CREATE TABLE结构）和内容（INSERT语句或分隔文本文件）。</p>
<p>适用于少量数据的备份，可以在其中编辑数据值或表结构。</p>
<p>特性：</p>
<ol>
<li>备份是通过查询MySQL服务器获取数据库结构和内容信息来完成的。</li>
<li>慢于物理备份</li>
<li>备份文件大于物理备份文件</li>
<li>无论何种存储引擎，备份和恢复的颗粒度支持server级别（所有database），database级别（选取的数据库的所有表）和table级别</li>
<li>备份不包括log和配置文件</li>
<li>备份是独立于机器的，具有高度的可移植性。</li>
<li>备份必须server处于运行状态</li>
</ol>
<h3 id="热备份VS温备份VS冷备份"><a href="#热备份VS温备份VS冷备份" class="headerlink" title="热备份VS温备份VS冷备份"></a>热备份VS温备份VS冷备份</h3><p><strong>热备份（online backup/“hot” backup）</strong></p>
<p>热备份需要MySQL服务器在运行中，这样数据信息可以通过服务器获取到</p>
<p>特性：</p>
<ol>
<li>备份对其他client的干扰较小，其他client可以在备份期间连接到MySQL服务器，并执行想要的操作。</li>
<li>必须注意实施适当的锁定，以免发生数据修改，影响备份的完整性。</li>
</ol>
<p><strong>冷备份（offline backup/“cold” backup）</strong></p>
<p>冷备份是在MySQL服务器停止运行时进行备份</p>
<p>特性：</p>
<ol>
<li>备份期间client会受到影响，基于这个原因，通常从一个可以离线的从服务器中进行备份</li>
<li>因为不会受client的干扰，这个备份会更简单</li>
</ol>
<p><strong>温备份（“warm” backup）</strong></p>
<p>温备份是指MySQL服务器保持运行，但锁定了所要备份的数据库，备份期间不允许修改。</p>
<h3 id="完全备份VS增量备份"><a href="#完全备份VS增量备份" class="headerlink" title="完全备份VS增量备份"></a>完全备份VS增量备份</h3><p>完全备份是指对数据库进行一个完整的备份。</p>
<p>增量备份是指在上次的完全备份基础上，对更新的数据进行备份。</p>
<h2 id="MySQL官方提供的备份方法"><a href="#MySQL官方提供的备份方法" class="headerlink" title="MySQL官方提供的备份方法"></a>MySQL官方提供的备份方法</h2><h3 id="MySQL-Enterprise-Backup"><a href="#MySQL-Enterprise-Backup" class="headerlink" title="MySQL Enterprise Backup"></a>MySQL Enterprise Backup</h3><p>可提供的备份类型：</p>
<ol>
<li>提供database，表的物理备份</li>
<li>也可以做增量备份和压缩备份</li>
<li>比逻辑备份速度快</li>
<li>为InnoDb提供热备份，其他存储引擎提供温备份</li>
</ol>
<p>该工具是MySQL提供的企业级备份方案，mysqlbackup为其提供的命令行工具，为付费版。</p>
<h3 id="mysqldump"><a href="#mysqldump" class="headerlink" title="mysqldump"></a>mysqldump</h3><ol>
<li>对于InnoDB，支持不使用任何锁的热备（通过加–single-transaction选项实现）</li>
</ol>
<h3 id="复制表文件"><a href="#复制表文件" class="headerlink" title="复制表文件"></a>复制表文件</h3><p>通过复制硬盘上数据库文件（如.frm, .MYD, 和.MYI）来进行备份，为了信息的一致性，需要停止MySQL服务或者锁定和刷新相关表（mysql为了提高其性能，部分数据时缓存在内存中，因此备份时要刷新表）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLUSH TABLES tbl_list WITH READ LOCK;</span><br></pre></td></tr></table></figure>
<p>代表工具：mysqlhotcopy</p>
<p>注意：该方式不适用于包含InnoDB表的数据库，因为即使服务器没有更新数据库了，对于InnoDB，有可能还有修改的数据在内存中，并未刷新到硬盘中。</p>
<h3 id="基于分隔符文本的备份"><a href="#基于分隔符文本的备份" class="headerlink" title="基于分隔符文本的备份"></a>基于分隔符文本的备份</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * INTO OUTFILE &apos;file_name&apos; FROM tbl_name;</span><br></pre></td></tr></table></figure>
<ol>
<li>使用以上命令进行分隔符文本的备份。</li>
<li>只能备份表数据，不能备份表结构。</li>
<li>该备份文件生成在MySQL服务器上，而非client上，输出文件存在被改写的风险。</li>
<li><p>重新加载分隔符文本可采用 <a href="https://dev.mysql.com/doc/refman/5.7/en/load-data.html" target="_blank" rel="noopener"><code>LOAD DATA INFILE</code></a> or <a href="https://dev.mysql.com/doc/refman/5.7/en/mysqlimport.html" target="_blank" rel="noopener"><strong>mysqlimport</strong></a></p>
<p><a href="https://dev.mysql.com/doc/refman/5.7/en/mysqldump.html" target="_blank" rel="noopener"><strong>mysqldump</strong></a>也提供了分隔符文件的方式，通过–tab选项实现。</p>
</li>
</ol>
<h3 id="基于二进制文件的增量备份"><a href="#基于二进制文件的增量备份" class="headerlink" title="基于二进制文件的增量备份"></a>基于二进制文件的增量备份</h3><p>启动MySQL服务器时通过–log-bin选项启动，以此开启二进制文件功能。</p>
<h2 id="常用备份工具对比"><a href="#常用备份工具对比" class="headerlink" title="常用备份工具对比"></a>常用备份工具对比</h2><table>
<thead>
<tr>
<th>名称</th>
<th>支持引擎</th>
<th>热备/冷备</th>
<th>备份速度</th>
<th>恢复速度</th>
<th>支持备份类型</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>MySQL Enterprise Backup</td>
<td>ALL</td>
<td>热备（InnoDB），温备（其他引擎）</td>
<td>快</td>
<td>快</td>
<td>物理备份，完全备份，增量备份，压缩备份</td>
<td>付费</td>
</tr>
<tr>
<td>mysqldump</td>
<td>ALL</td>
<td>热备（InnoDB），温备（其他引擎）</td>
<td>中等</td>
<td>慢</td>
<td>逻辑备份，完全备份，增量备份</td>
<td>免费</td>
</tr>
<tr>
<td>ibbackup</td>
<td>ALL</td>
<td>热备（InnoDB），温备（其他引擎）</td>
<td>快</td>
<td>快</td>
<td>在线备份、增量备份、完全备份</td>
<td>付费</td>
</tr>
<tr>
<td>Xtrabackup</td>
<td>ALL</td>
<td>热备（InnoDB），温备（其他引擎）</td>
<td>快</td>
<td>快</td>
<td>物理备份，完全备份，增量备份</td>
<td>免费</td>
</tr>
<tr>
<td>mysqlhotcopy</td>
<td>MyISAM</td>
<td>接近冷备，需要服务器停止运行或不存在数据更新</td>
<td>快</td>
<td>快</td>
<td>逻辑备份，完全备份，增量备份</td>
<td>免费，unix</td>
</tr>
<tr>
<td>lvm-snapshot</td>
<td>ALL</td>
<td>热备</td>
<td>快</td>
<td>快</td>
<td>快照备份</td>
<td>免费，仅对LVM文件系统有效</td>
</tr>
<tr>
<td>cp命令</td>
<td>ALL</td>
<td>冷备</td>
<td>超快</td>
<td>超快</td>
<td>物理备份，完全备份</td>
<td>免费</td>
</tr>
</tbody>
</table>
<h2 id="备份策略"><a href="#备份策略" class="headerlink" title="备份策略"></a>备份策略</h2><table>
<thead>
<tr>
<th>策略</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td>直接拷贝数据库文件</td>
<td>适合小型数据库，速度快，备份时为保持一致性，需要关闭服务器或锁定数据库表</td>
</tr>
<tr>
<td>完全备份+增量备份+日志文件</td>
<td>适合中小型数据库，速度较慢。</td>
</tr>
<tr>
<td>主从方式复制</td>
<td>适合大型数据库，从机的数据实时与主机保持一致，主从复制方式下，为避免主机数据误删等操作，仍需对从机进行其他方式的备份</td>
</tr>
</tbody>
</table>
<h3 id="具体备份方案"><a href="#具体备份方案" class="headerlink" title="具体备份方案"></a>具体备份方案</h3><table>
<thead>
<tr>
<th>备份方式</th>
<th>频率</th>
<th>工具</th>
</tr>
</thead>
<tbody>
<tr>
<td>全备</td>
<td>每周日凌晨3点备份</td>
<td>mysqldump</td>
</tr>
<tr>
<td>binlog</td>
<td>有更改就会生成二进制文件</td>
<td>binlog日志</td>
</tr>
</tbody>
</table>
<p>增量备份通过MySQL的binlog来实现，如下配置</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#打开配置文件，找到log_bin所在行，去掉#注释</span></span><br><span class="line">sudo vi /etc/mysql/my.cnf</span><br><span class="line"><span class="comment">#重启MySQL</span></span><br><span class="line">sudo /etc/init.d/mysql restart</span><br></pre></td></tr></table></figure>
<p>二进制文件会保存在/var/log/mysql/mysql-bin.log目录下，每次备份的增量文件是基于全备生成的。</p>
<p>增量文件的生成方式为：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u root -p123 --flush-logs --master-data=2 --delete-master-logs --all-databases&gt; <span class="variable">$&#123;dir&#125;</span>/alldatabase.sql</span><br><span class="line"></span><br><span class="line">参数说明：</span><br><span class="line">--flush-logs：生成新的二进制日志文件</span><br><span class="line">--master-data=2：新的二进制文件的起始编号</span><br><span class="line">--delete-master-logs：清空先前的备份文件</span><br></pre></td></tr></table></figure>
<p>通过增量文件恢复数据库的方式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p123 &lt; mysql-bin.000001</span><br></pre></td></tr></table></figure>
<p>全备方案采用脚本的形式，每周日的凌晨3点定时备份，所有备份文件保存在已备份日期命名的文件夹下，具体的脚本参照mysql-backup.sh，对应的恢复脚本参照mysql-recovery.sh。</p>
<p>定时执行采用crontab实现，通过crontab -e设置定时任务，各项具体具体的设置参考<a href="http://www.cnblogs.com/longjshz/p/5779215.html" target="_blank" rel="noopener">http://www.cnblogs.com/longjshz/p/5779215.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/01/mysql备份/" data-id="cjkaxkb930001zsrhlf6v0c0j" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-nodejs通过child_process.exec调用shell脚本" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/01/nodejs通过child_process.exec调用shell脚本/" class="article-date">
  <time datetime="2018-08-01T09:23:09.000Z" itemprop="datePublished">2018-08-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/01/nodejs通过child_process.exec调用shell脚本/">nodejs通过child_process.exec调用shell脚本</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>某些场景的处理可能用其他语言脚本比Nodejs更方便，nodejs只需要调用脚本处理来获取结果，以做进一步处理。那么nodejs如何调用脚本并获取脚本执行的结果呢？</p>
<p>child_process模块可以实现该功能。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">child_process.exec(command[, options][, callback])</span><br><span class="line"></span><br><span class="line">参数含义：</span><br><span class="line">command  运行的命令，参数使用空格分隔。</span><br><span class="line">options</span><br><span class="line">    cwd 子进程的当前工作目录。</span><br><span class="line">    env 环境变量键值对。</span><br><span class="line">    encoding  默认为 utf8。</span><br><span class="line">    shell  执行命令的 shell。在 UNIX 上默认为 `&apos;/bin/sh&apos;`，在 Windows 上默认为 `process.env.ComSpec`。</span><br><span class="line">    timeout 默认为 `0`。</span><br><span class="line">    maxBuffer  stdout 或 stderr 允许的最大字节数。默认为 200*1024。如果超过限制，则子进程会被终止。</span><br><span class="line">    killSignal 默认为 &apos;SIGTERM&apos;。</span><br><span class="line">    uid 设置进程的用户标识。</span><br><span class="line">    gid 设置进程的组标识。</span><br><span class="line">    windowsHide 隐藏子进程的控制台窗口，常用于 Windows 系统。默认为 false。</span><br><span class="line">callback 进程终止时调用。</span><br><span class="line">    error</span><br><span class="line">    stdout</span><br><span class="line">    stderr</span><br></pre></td></tr></table></figure>
<p>command 中可以直接使用shell 命令或是其他脚本文件的执行命令。</p>
<p>child_process.exec是新开一个进程进行处理，不会阻塞nodejs之后的代码的运行。</p>
<p>child_process.exec执行完command后，如果有回调函数，会调用回调函数callback，回调函数有三个参数，error,stdout, stderr.</p>
<p>如果执行成功，error为null，执行失败，error为Error对象（<a href="http://nodejs.cn/api/errors.html#errors_errors%EF%BC%89" target="_blank" rel="noopener">http://nodejs.cn/api/errors.html#errors_errors）</a></p>
<p>脚本执行后的结果从stdout和stderr中获得，默认的编码方式是utf8，可以通过option中的encoding来设置实际的编码方式。</p>
<p>举例：</p>
<p>调用shell 命令</p>
<p>新建testexec.js文件</p>
<ol>
<li>测试date命令</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var exec = require(&apos;child_process&apos;).exec;</span><br><span class="line">var colors = require( &quot;colors&quot;)</span><br><span class="line">exec(&quot;date&quot;, function(err, stdout, stderr)&#123;</span><br><span class="line">  console.log(&quot;\n---&gt;test shell command date result:&quot;.green);</span><br><span class="line">  console.log(&apos;err:&apos;);</span><br><span class="line">  console.log(err);</span><br><span class="line">  console.log(&apos;stdout:&apos; + stdout);</span><br><span class="line">  console.log(&apos;stderr:&apos; + stderr);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行node testexec.js, 结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---&gt;test shell command date result:</span><br><span class="line">err:</span><br><span class="line">null</span><br><span class="line">stdout:2018年 05月 27日 星期日 15:21:32 CST</span><br><span class="line"></span><br><span class="line">stderr:</span><br></pre></td></tr></table></figure>
<p>执行成功，输出在stdout中。</p>
<ol>
<li>测试不存在的shell命令qwe</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var exec = require(&apos;child_process&apos;).exec;</span><br><span class="line">var colors = require( &quot;colors&quot;)</span><br><span class="line">exec(&quot;qwr&quot;, function(err, stdout, stderr)&#123;</span><br><span class="line">  console.log(&quot;\n---&gt;test undefined shell command qwr result:&quot;.green);</span><br><span class="line">  console.log(&apos;err:&apos;);</span><br><span class="line">  console.log(err);</span><br><span class="line">  console.log(&apos;stdout:&apos; + stdout);</span><br><span class="line">  console.log(&apos;stderr:&apos; + stderr);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">---&gt;test undefined shell command qwr result:</span><br><span class="line">err:</span><br><span class="line">&#123; Error: Command failed: qwr</span><br><span class="line">/bin/sh: 1: qwr: not found</span><br><span class="line">    at ChildProcess.exithandler (child_process.js:270:12)</span><br><span class="line">    at emitTwo (events.js:125:13)</span><br><span class="line">    at ChildProcess.emit (events.js:213:7)</span><br><span class="line">    at maybeClose (internal/child_process.js:927:16)</span><br><span class="line">    at Socket.stream.socket.on (internal/child_process.js:348:11)</span><br><span class="line">    at emitOne (events.js:115:13)</span><br><span class="line">    at Socket.emit (events.js:210:7)</span><br><span class="line">    at Pipe._handle.close [as _onclose] (net.js:545:12) killed: false, code: 127, signal: null, cmd: &apos;qwr&apos; &#125;</span><br><span class="line">stdout:</span><br><span class="line">stderr:/bin/sh: 1: qwr: not found</span><br></pre></td></tr></table></figure>
<p>执行失败，err参数输出Error对象，错误信息输出在stderr中。</p>
<ol>
<li>调用python脚本</li>
</ol>
<p><a href="http://xn--pythontest-lg1th85dmnegp4i.py" target="_blank" rel="noopener">新建python脚本test.py</a>，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># -*- encoding: utf-8 -*-</span><br><span class="line">import sys</span><br><span class="line">argv1 = sys.argv[1]</span><br><span class="line">if argv1 != &apos;1&apos;:  </span><br><span class="line">  sys.stderr.write(&apos;argv error&apos;)</span><br><span class="line">  sys.exit(-1)</span><br><span class="line">print(&apos;argv correct&apos;)</span><br><span class="line">sys.stdout.write(&apos;success&apos;)</span><br></pre></td></tr></table></figure>
<p>该脚本实现的是，当输入参数为1时，输出success，否则输出argv error.</p>
<p>调用python脚本代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">exec(&quot;python test.py 1&quot;, function(err, stdout, stderr)&#123;</span><br><span class="line">  console.log(&quot;\n---&gt;test python file with argv 1:&quot;.green);</span><br><span class="line">  console.log(&apos;err:&apos;);</span><br><span class="line">  console.log(err);</span><br><span class="line">  console.log(&apos;stdout:&apos; + stdout);</span><br><span class="line">  console.log(&apos;stderr:&apos; + stderr);</span><br><span class="line">&#125;);</span><br><span class="line">exec(&quot;python test.py 2&quot;, function(err, stdout, stderr)&#123;</span><br><span class="line">  console.log(&quot;\n---&gt;test python file with other argv :&quot;.green);</span><br><span class="line">  console.log(&apos;err:&apos;);</span><br><span class="line">  console.log(err);</span><br><span class="line">  console.log(&apos;stdout:&apos; + stdout);</span><br><span class="line">  console.log(&apos;stderr:&apos; + stderr);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">---&gt;test python file with argv 1:</span><br><span class="line">err:</span><br><span class="line">null</span><br><span class="line">stdout:argv correct</span><br><span class="line">success</span><br><span class="line">stderr:</span><br><span class="line"></span><br><span class="line">---&gt;test python file with other argv :</span><br><span class="line">err:</span><br><span class="line">&#123; Error: Command failed: python test.py 2</span><br><span class="line">argv error</span><br><span class="line">    at ChildProcess.exithandler (child_process.js:270:12)</span><br><span class="line">    at emitTwo (events.js:125:13)</span><br><span class="line">    at ChildProcess.emit (events.js:213:7)</span><br><span class="line">    at maybeClose (internal/child_process.js:927:16)</span><br><span class="line">    at Socket.stream.socket.on (internal/child_process.js:348:11)</span><br><span class="line">    at emitOne (events.js:115:13)</span><br><span class="line">    at Socket.emit (events.js:210:7)</span><br><span class="line">    at Pipe._handle.close [as _onclose] (net.js:545:12)</span><br><span class="line">  killed: false,</span><br><span class="line">  code: 255,</span><br><span class="line">  signal: null,</span><br><span class="line">  cmd: &apos;python test.py 2&apos; &#125;</span><br><span class="line">stdout:</span><br><span class="line">stderr:argv error</span><br></pre></td></tr></table></figure>
<p>需要注意的是，如果调用的是其他语言的脚本文件，需要将执行结果或出错结果输出到stdout或stderr中，这样才能在process_child.exec的回调参数中进行处理。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/01/nodejs通过child_process.exec调用shell脚本/" data-id="cjkaxkb970003zsrhcdtdybgd" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-数据库全局主键生成策略" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/01/数据库全局主键生成策略/" class="article-date">
  <time datetime="2018-08-01T09:21:30.000Z" itemprop="datePublished">2018-08-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/01/数据库全局主键生成策略/">数据库全局主键生成策略</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="auto-incrementing-主键自增"><a href="#auto-incrementing-主键自增" class="headerlink" title="auto-incrementing(主键自增)"></a>auto-incrementing(主键自增)</h2><p>数据库中设置为int，short的主键，可直接依赖数据库的自增机制，按数值顺序自增，新插入的记录的id值等于上条记录id值加1。</p>
<p>优点：生成简单，记录有序，查询效率高。</p>
<p>缺点：写性能直接影响了每秒生成主键值的数量，扩展差，对于分布式数据库，可能存在重复id</p>
<h2 id="UUID"><a href="#UUID" class="headerlink" title="UUID"></a>UUID</h2><p>uuid 是由一定算法（包括MAC地址，时间戳等）计算生成的16字节128位长的数字，通常由由 8-4-4-4-12的形式组成的36位字符串表示。</p>
<p>示例如下：</p>
<p>43028980-824a-11e7-90ff-05a17a466c71</p>
<p>uuid的组成如下所示</p>
<p>uuid.PNG</p>
<p>分为多个版本，不同版本对应的node不同，有基于时间的（v1）, 基于DCE的（v2），使用MD5基于名字的（v3）, 基于随机数的（v4），使用SHA-1基于名字（v5）。</p>
<p>具体的算法请参照：</p>
<p><a href="https://tools.ietf.org/html/rfc4122#section-4" target="_blank" rel="noopener">https://tools.ietf.org/html/rfc4122#section-4</a></p>
<p>其中基于时间的uuid（v1）使用MAC地址，可以保证id全球范围内唯一。</p>
<p>优点：</p>
<p>v1适合应用分布式环境，有高度的唯一性。</p>
<p>缺点：</p>
<p>字符串长度过长，占用存储空间，无法保证递增，通过索引查询效率低。</p>
<h2 id="当前时间毫秒与微秒生成"><a href="#当前时间毫秒与微秒生成" class="headerlink" title="当前时间毫秒与微秒生成"></a>当前时间毫秒与微秒生成</h2><p>优点：生成方式简单，递增。</p>
<p>缺点：1微秒内生成多个会重复，分布式集群时无法保证唯一性。</p>
<h2 id="建立id表方式"><a href="#建立id表方式" class="headerlink" title="建立id表方式"></a>建立id表方式</h2><p>专门用n台服务器各自维护一张Sequence表，表中存储的记录为下次使用的id值，id值的增长步进为服务器的数量，id的初值分别为1,2,…，n。每个id表每次需要新id时，向服务器进行申请，并设置下次的id值。</p>
<p>优点：</p>
<p>进行了分流，改善了当某台服务器无法使用了，就无法生成主键的问题，解决了性能瓶颈和单点问题。主键自增，能提高查询效率。</p>
<p>缺点：</p>
<p>服务器数量定好后，后续的扩展空间不大，服务器增加数量越多，维护成本也大。</p>
<h2 id="snowflake"><a href="#snowflake" class="headerlink" title="snowflake"></a>snowflake</h2><p>为Twitter发布的一套主键生成策略，只有2010年的版本，依赖Twitter内部的Infrastructure，目前已没有维护。可以参考其思路。</p>
<p>结构：</p>
<p>0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000</p>
<p>第1位未使用，紧接着41bit为时间戳，再接着10bit为工作机器id，再接着为12bit序列号。</p>
<p>参考：<a href="https://github.com/twitter/snowflake" target="_blank" rel="noopener">https://github.com/twitter/snowflake</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/01/数据库全局主键生成策略/" data-id="cjkaxkb9a0005zsrhixo1s8c8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-webpack" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/01/webpack/" class="article-date">
  <time datetime="2018-08-01T09:19:43.000Z" itemprop="datePublished">2018-08-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/01/webpack/">webpack</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><p>webpack是一个现代 JavaScript 应用程序的<strong>模块打包器</strong>，它从指定的入口文件开始进行分析，找到JavaScript模块非 JavaScript 文件，对其进行转换和处理，最终打包成一个或多个bundle供浏览器使用。</p>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>webpack有四个核心概念（详见官方文档：<a href="https://doc.webpack-china.org/concepts/）：" target="_blank" rel="noopener">https://doc.webpack-china.org/concepts/）：</a></p>
<ul>
<li>入口（entry）</li>
<li>输出（output）</li>
<li>loader</li>
<li>插件（plugins）</li>
</ul>
<h3 id="入口entry"><a href="#入口entry" class="headerlink" title="入口entry"></a>入口entry</h3><p>入口用于指定webpack开始打包的入口文件，支持单个入口和多个入口。</p>
<p>单入口例子</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">'./src/index.js'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>多入口例子</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: <span class="string">'./src/index.js'</span>,</span><br><span class="line">    another: <span class="string">'./src/another.js'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="输出output"><a href="#输出output" class="headerlink" title="输出output"></a>输出output</h3><p>用于设置打包输出文件的文件名，文件位置等。</p>
<p>配置单入口输出例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: <span class="string">'./src/index.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>), <span class="comment">//设置输出文件保存文件夹</span></span><br><span class="line">    filename: <span class="string">'bundle.js'</span>  <span class="comment">//设置打包后的bundle的文件名</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置多入口输出例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: <span class="string">'./src/index.js'</span>,</span><br><span class="line">    another: <span class="string">'./src/another.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>), <span class="comment">//设置输出文件保存文件夹</span></span><br><span class="line">    filename: <span class="string">'[name].bundle.js'</span>,  <span class="comment">//通过入口名称来设置输出文件名，最后的输出为index.bundle.js和another.bundle.js</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h3><p>loader 可以将所有类型的文件转换为 webpack 能够处理的有效模块，然后你就可以利用 webpack 的打包能力，对它们进行处理。</p>
<p>在webpack配置文件中定义loader时，要定义在module.rules中。</p>
<p>loader通过<code>test</code>和<code>use</code>属性来进行配置不同的文件所要选择的转换器：</p>
<ul>
<li><code>test</code>配置文件过滤规则</li>
<li><code>use</code>配置使用的转换模块</li>
</ul>
<p>常用的loader列表详见<a href="https://doc.webpack-china.org/loaders/babel-loader/。" target="_blank" rel="noopener">https://doc.webpack-china.org/loaders/babel-loader/。</a></p>
<p>例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: <span class="string">'./src/index.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>), <span class="comment">//设置输出文件保存文件夹</span></span><br><span class="line">    filename: <span class="string">'bundle.js'</span>  <span class="comment">//设置打包后的bundle的文件名</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      <span class="comment">//图片使用file-loader模块进行转换</span></span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|svg|jpg|gif)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">            <span class="string">'file-loader'</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="插件plugins"><a href="#插件plugins" class="headerlink" title="插件plugins"></a>插件plugins</h3><p>插件可用来处理打包优化，压缩等各种各样的任务。常见插件列表见：<a href="https://doc.webpack-china.org/plugins" target="_blank" rel="noopener">https://doc.webpack-china.org/plugins</a></p>
<p>使用方法为<code>require()</code> 插件，然后把它添加到 <code>plugins</code> 数组中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: <span class="string">'./src/index.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>), <span class="comment">//设置输出文件保存文件夹</span></span><br><span class="line">    filename: <span class="string">'bundle.js'</span>  <span class="comment">//设置打包后的bundle的文件名</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      <span class="comment">//图片使用file-loader模块进行转换</span></span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|svg|jpg|gif)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">            <span class="string">'file-loader'</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">        name: <span class="string">'common'</span> <span class="comment">// 指定公共 bundle 的名称。</span></span><br><span class="line">      &#125;),</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="简单的打包实例"><a href="#简单的打包实例" class="headerlink" title="简单的打包实例"></a>简单的打包实例</h2><p>通过npm建立一个空工程，步骤如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir webpack-demo &amp;&amp; cd webpack-demo</span><br><span class="line">npm init -y</span><br><span class="line">npm install --save-dev webpack</span><br></pre></td></tr></table></figure>
<p>webpack的安装可以全局安装和局部安装，建议使用本地安装（<figure class="highlight plain"><figcaption><span>install --save-dev webpack```）这样可以根据工程配置来使用webpack的版本，兼容性强。</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">通过npm建立工程目录后，在目录下添加文件夹/dist用于存放打包输出文件，/src用于存放打包源文件。在/src在新建index.js，在根目录下新建index.html。具体的文件位置如下所示。</span><br></pre></td></tr></table></figure></p>
<p>  webpack-demo<br>  |- package.json</p>
<ul>
<li>|- /dist</li>
<li>|- /src</li>
<li>|- index.js</li>
<li>|- index.html<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">index.js代码如下：</span><br><span class="line"></span><br><span class="line">```js</span><br><span class="line">function component() &#123;</span><br><span class="line">  var element = document.createElement(&apos;div&apos;);</span><br><span class="line"></span><br><span class="line">  element.innerHTML = &quot;hello webpack&quot;;</span><br><span class="line"></span><br><span class="line">  return element;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">document.body.appendChild(component());</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>index.html代码如下</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>webpack test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dist/bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>执行webpack打包, webpack 后面第一个参数是打包的入口文件，第二个参数是输出的打包文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./node_modules/.bin/webpack src/index.js dist/bundle.js</span><br></pre></td></tr></table></figure>
<p>执行结果如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Hash: 160f28da4a3068f78298</span><br><span class="line">Version: webpack 3.8.1</span><br><span class="line">Time: 54ms</span><br><span class="line">    Asset     Size  Chunks             Chunk Names</span><br><span class="line">bundle.js  2.65 kB       0  [emitted]  main</span><br><span class="line">   [0] ./src/index.js 172 bytes &#123;0&#125; [built]</span><br></pre></td></tr></table></figure>
<p>可发现在/dist目录下生成了bundle.js，该文件即为打包好的库，运行index.html文件，可发现html显示”hello webpack”。</p>
<h2 id="通过配置文件打包"><a href="#通过配置文件打包" class="headerlink" title="通过配置文件打包"></a>通过配置文件打包</h2><p>配置文件打包可进行更多复杂的设置。配置文件通过配置上述所讲的entry，output，loader，plugins来优化打包，实现更多功能。</p>
<p>仅以一个简单的例子进行配置文件打包说明。项目基于上节“简单的打包实例”中的项目进行配置。</p>
<h3 id="新建css文件"><a href="#新建css文件" class="headerlink" title="新建css文件"></a>新建css文件</h3><p>在上述打包实例的项目的基础上，在/src目录下新建style.css文件，代码如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.hello</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改/src/index.js文件，引入style.css，完整的index.js代码如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./style.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">component</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> element = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line"></span><br><span class="line">  element.innerHTML = <span class="string">"hello webpack"</span>;</span><br><span class="line">  element.classList.add(<span class="string">'hello'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> element;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(component());</span><br></pre></td></tr></table></figure>
<h3 id="新建配置文件"><a href="#新建配置文件" class="headerlink" title="新建配置文件"></a>新建配置文件</h3><p>在上述打包实例的项目的基础上，在根目录下新建webpack.build.config.js，一个基本的配置如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">'./src/index.js'</span>,<span class="comment">//入口文件，webpack从该文件开始进行打包解析</span></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span>, <span class="comment">//打包输出的文件名</span></span><br><span class="line">    path: path.resolve(__dirname, <span class="string">"dist"</span>),<span class="comment">//打包后，文件的输出路径</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [ <span class="comment">//配置文件需要的加载器</span></span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,<span class="comment">//排除node_modules，加快转译</span></span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">'babel-loader'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">            <span class="string">'style-loader'</span>,</span><br><span class="line">            <span class="string">'css-loader'</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="安装所需模块"><a href="#安装所需模块" class="headerlink" title="安装所需模块"></a>安装所需模块</h3><p>上述配置模块引入了babel-loader，style-loader，css-loader模块，需要通过npm 安装。安装方法：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev babel-core</span><br><span class="line">npm install --save-dev babel-loader</span><br><span class="line">npm install --save-dev css-loader</span><br><span class="line">npm install --save-dev style-loader</span><br></pre></td></tr></table></figure>
<h3 id="配置npm执行脚本"><a href="#配置npm执行脚本" class="headerlink" title="配置npm执行脚本"></a>配置npm执行脚本</h3><p>配置package.json脚本的<code>scripts</code>，增加<code>&quot;build&quot;: &quot;webpack --config webpack.build.config.js&quot;</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">  "test": "echo \"Error: no test specified\" &amp;&amp; exit 1",</span><br><span class="line">  "build": "webpack --config webpack.build.config.js"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="执行webpack"><a href="#执行webpack" class="headerlink" title="执行webpack"></a>执行webpack</h3><p>在终端运行<code>npm run build</code>即可以生成打包文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; webpack-demo@1.0.0 build /home/tingting.liu/test/webpack/webpack-demo</span><br><span class="line">&gt; webpack --config webpack.build.config.js</span><br><span class="line"></span><br><span class="line">Hash: f513b6f0047f751d9c47</span><br><span class="line">Version: webpack 3.8.1</span><br><span class="line">Time: 716ms</span><br><span class="line">    Asset     Size  Chunks             Chunk Names</span><br><span class="line">bundle.js  19.1 kB       0  [emitted]  main</span><br><span class="line">   [0] ./src/index.js 228 bytes &#123;0&#125; [built]</span><br><span class="line">   [1] ./src/style.css 1.01 kB &#123;0&#125; [built]</span><br><span class="line">   [2] ./node_modules/css-loader!./src/style.css 193 bytes &#123;0&#125; [built]</span><br><span class="line">    + 3 hidden modules</span><br></pre></td></tr></table></figure>
<p>浏览器中打开index.html可看到红色的”hello webpack”。</p>
<h2 id="建立开发环境"><a href="#建立开发环境" class="headerlink" title="建立开发环境"></a>建立开发环境</h2><p>webpack提供了很多插件和loader模块来使开发调试更容易。开发环境中所使用的工具不要用在生产环境中了。</p>
<h3 id="source-map"><a href="#source-map" class="headerlink" title="source map"></a>source map</h3><p>开发环境中可使用devtool设置source map来方便调试，定位出错位置。在开发环境中，建议使用的devtool为<code>eval-source-map</code>选项。</p>
<h3 id="webpack-dev-server"><a href="#webpack-dev-server" class="headerlink" title="webpack-dev-server"></a>webpack-dev-server</h3><p>开发环境中可使用webpack-dev-server来提供一个简单的web服务器，并实时加载修改后的内容。</p>
<h3 id="详细配置"><a href="#详细配置" class="headerlink" title="详细配置"></a>详细配置</h3><p>在上述工程根目录新建文件webpack.dev.config.js, 文件内容如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">'./src/index.js'</span>,<span class="comment">//入口文件，webpack从该文件开始进行打包解析</span></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span>, <span class="comment">//打包输出的文件名</span></span><br><span class="line">    publicPath: <span class="string">'/dist/'</span>, <span class="comment">//设置url的公共路径</span></span><br><span class="line">    path: path.resolve(__dirname, <span class="string">"dist"</span>),<span class="comment">//打包后，文件的输出路径</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [ <span class="comment">//配置文件需要的加载器</span></span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,<span class="comment">//排除node_modules，加快转译</span></span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">'babel-loader'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">            <span class="string">'style-loader'</span>,</span><br><span class="line">            <span class="string">'css-loader'</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//devServer对应webpack-dev-server模块，作为本地开发服务器，用于监听代码修改，自动刷新修改后的结果</span></span><br><span class="line">  devServer: &#123;</span><br><span class="line">    host: <span class="string">"172.31.34.236"</span>,<span class="comment">//Host不配置的话默认为localhost</span></span><br><span class="line">    port:<span class="string">"8080"</span>,<span class="comment">//port默认为8080</span></span><br><span class="line">    historyApiFallback: <span class="literal">true</span>,<span class="comment">//设置为true时，所有的跳转将指向index.html</span></span><br><span class="line">    inline:<span class="literal">true</span><span class="comment">//实时刷新</span></span><br><span class="line">  &#125;,</span><br><span class="line">  devtool: <span class="string">'eval-source-map'</span> <span class="comment">//使编译后的代码可读性更高，也更容易调试</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>webpack-dev-server需要通过npm安装，安装方法：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev webpack-dev-server</span><br></pre></td></tr></table></figure>
<p>配置package.json脚本的<code>scripts</code>，增加<code>&quot;dev&quot;: &quot;webpack-dev-server --config webpack.dev.config.js&quot;</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">  "test": "echo \"Error: no test specified\" &amp;&amp; exit 1",</span><br><span class="line">  "build": "webpack --config webpack.build.config.js",</span><br><span class="line">  "dev": "webpack-dev-server --config webpack.dev.config.js"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行<code>npm run dev</code>，在浏览器输入172.31.34.236:8080可以看到红色的”hello webpack”，修改style.css文件中的<code>color:red</code>为<code>color:blue</code>，不需要重新执行npm脚本，即可以在浏览器中实时看到字体颜色变为蓝色。</p>
<p>devtool还有很多类型配置，适应于不同的开发环境和生产环境，更详细的参见<a href="https://doc.webpack-china.org/configuration/devtool" target="_blank" rel="noopener">https://doc.webpack-china.org/configuration/devtool</a></p>
<p>webpack-dev-server模块的更多参数的设置可参见<a href="https://doc.webpack-china.org/configuration/dev-server" target="_blank" rel="noopener">https://doc.webpack-china.org/configuration/dev-server</a></p>
<h2 id="建立生产环境"><a href="#建立生产环境" class="headerlink" title="建立生产环境"></a>建立生产环境</h2><p>开发环境主要用于前期的调试开发，生产环境用于打包发布文件。开发环境和生产环境的目标是不一致的，开发环境需要更强大的实时加载调试等功能，而生产环境需要的是更轻量的source map，更优化的资源来加快加载时间。不同的环境建议配置不同的webpack文件。</p>
<h3 id="source-map-1"><a href="#source-map-1" class="headerlink" title="source map"></a>source map</h3><p>在生产环境中建议devtool使用<code>source-map</code>选项。</p>
<h3 id="压缩JS代码"><a href="#压缩JS代码" class="headerlink" title="压缩JS代码"></a>压缩JS代码</h3><p>使用UglifyJsPlugin插件进行JS代码压缩。</p>
<h3 id="压缩文件"><a href="#压缩文件" class="headerlink" title="压缩文件"></a>压缩文件</h3><p>CompressionWebpackPlugin提供带 Content-Encoding 编码的压缩版的资源</p>
<h3 id="指定环境"><a href="#指定环境" class="headerlink" title="指定环境"></a>指定环境</h3><p>许多 library 将通过与 <code>process.env.NODE_ENV</code> 环境变量关联，以决定 library 中应该引用哪些内容。使用 <code>process.env.NODE_ENV === &#39;production&#39;</code> 时，一些 library 可能针对具体用户的环境进行代码优化，从而删除或添加一些重要代码。可以使用 webpack 内置的 DefinePlugin为所有的依赖定义这个变量，具体的配置参见下文的webpack.prod.config.js文件</p>
<h3 id="详细配置-1"><a href="#详细配置-1" class="headerlink" title="详细配置"></a>详细配置</h3><p>在上述项目的根目录下，新建webpack.prod.config.js文件，具体的配置如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="keyword">const</span> CompressionPlugin = <span class="built_in">require</span>(<span class="string">'compression-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">'./src/index.js'</span>,<span class="comment">//入口文件，webpack从该文件开始进行打包解析</span></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span>, <span class="comment">//打包输出的文件名</span></span><br><span class="line">    publicPath: <span class="string">'/dist/'</span>, <span class="comment">//</span></span><br><span class="line">    path: path.resolve(__dirname, <span class="string">"dist"</span>),<span class="comment">//打包后，文件的输出路径</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [ <span class="comment">//配置文件需要的加载器</span></span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,<span class="comment">//排除node_modules，加快转译</span></span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">'babel-loader'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">            <span class="string">'style-loader'</span>,</span><br><span class="line">            <span class="string">'css-loader'</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  devtool: <span class="string">'source-map'</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">        <span class="string">'process.env.NODE_ENV'</span>: <span class="string">'"production"'</span><span class="comment">//指定环境</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(),<span class="comment">//压缩JS代码</span></span><br><span class="line">    <span class="keyword">new</span> CompressionPlugin(&#123;</span><br><span class="line">      test: <span class="regexp">/\.(js|css)$/</span>,<span class="comment">//处理的文件类型</span></span><br><span class="line">      threshold: <span class="number">10240</span>,<span class="comment">//只处理比该值大的资源</span></span><br><span class="line">      minRatio: <span class="number">0.8</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>通过npm安装compression-webpack-plugin</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev compression-webpack-plugin</span><br></pre></td></tr></table></figure>
<p>配置package.json脚本的<code>scripts</code>，增加<code>&quot;prod&quot;: &quot;webpack --config webpack.prod.config.js&quot;</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">  "test": "echo \"Error: no test specified\" &amp;&amp; exit 1",</span><br><span class="line">  "build": "webpack --config webpack.build.config.js",</span><br><span class="line">  "dev": "webpack-dev-server --config webpack.dev.config.js",</span><br><span class="line">  "prod": "webpack --config webpack.prod.config.js"</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>执行npm run prod, 执行结果如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Hash: 64791ac042c1626634db</span><br><span class="line">Version: webpack 3.8.1</span><br><span class="line">Time: 481ms</span><br><span class="line">    Asset     Size  Chunks             Chunk Names</span><br><span class="line">bundle.js  6.46 kB       0  [emitted]  main</span><br><span class="line">   [0] ./src/index.js 228 bytes &#123;0&#125; [built]</span><br><span class="line">   [1] ./src/style.css 1.01 kB &#123;0&#125; [built]</span><br><span class="line">   [2] ./node_modules/css-loader!./src/style.css 194 bytes &#123;0&#125; [built]</span><br><span class="line">    + 3 hidden modules</span><br></pre></td></tr></table></figure>
<p>会发现生成的bundle.js明显变小，打开生成的bundle.js，可以发现bundle.js内的代码为压缩代码。</p>
<h2 id="抽出公共配置"><a href="#抽出公共配置" class="headerlink" title="抽出公共配置"></a>抽出公共配置</h2><p>开发环境和生产环境中有些配置是相同的，避免过多的重复配置，可以将开发环境和生产环境中相同的配置抽离出来。</p>
<p>可以使用webpack-merge来解决该问题。</p>
<p>在上述项目根目录下新建webpack.common.config.js文件，将公共部分抽出来，配置如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">'./src/index.js'</span>,<span class="comment">//入口文件，webpack从该文件开始进行打包解析</span></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span>, <span class="comment">//打包输出的文件名</span></span><br><span class="line">    publicPath: <span class="string">'/dist/'</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">"dist"</span>),<span class="comment">//打包后，文件的输出路径</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [ <span class="comment">//配置文件需要的加载器</span></span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,<span class="comment">//排除node_modules，加快转译</span></span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">'babel-loader'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">            <span class="string">'style-loader'</span>,</span><br><span class="line">            <span class="string">'css-loader'</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>然后在不同的环境配置文件中通过webpack-merge来合并这些通用配置。</p>
<p>为方便后续阅读该文档时可以方便对照测试工程的代码，接下来合并通用配置将不会在webpack.dev.config.js和webpack.prod.config.js中直接修改，而是通过新建webpack.dev.common.config.js和webpack.prod.common.config.js来进行示例说明。</p>
<p>webpack.dev.common.config.js与webpack.dev.config.js实现的功能一致，webpack.prod.common.config.js与webpack.prod.config.js实现的功能一致。</p>
<p>新建webpack.dev.common.config.js文件，配置如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>);</span><br><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">'./webpack.common.config.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(common, &#123;</span><br><span class="line">  <span class="comment">//devServer对应webpack-dev-server模块，作为本地开发服务器，用于监听代码修改，自动刷新修改后的结果</span></span><br><span class="line">  devServer: &#123;</span><br><span class="line">    host: <span class="string">"172.31.34.236"</span>,<span class="comment">//Host不配置的话默认为localhost</span></span><br><span class="line">    port:<span class="string">"8080"</span>,<span class="comment">//port默认为8080</span></span><br><span class="line">    historyApiFallback: <span class="literal">true</span>,<span class="comment">//设置为true时，所有的跳转将指向index.html</span></span><br><span class="line">    inline:<span class="literal">true</span><span class="comment">//实时刷新</span></span><br><span class="line">  &#125;,</span><br><span class="line">  devtool: <span class="string">'eval-source-map'</span> <span class="comment">//使编译后的代码可读性更高，也更容易调试</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>新建webpack.prod.common.config.js文件，配置如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>);</span><br><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">'./webpack.common.config.js'</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="keyword">const</span> CompressionPlugin = <span class="built_in">require</span>(<span class="string">'compression-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(common, &#123;</span><br><span class="line">  devtool: <span class="string">'source-map'</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">        <span class="string">'process.env.NODE_ENV'</span>: <span class="string">'"production"'</span><span class="comment">//指定环境</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(),<span class="comment">//压缩JS代码</span></span><br><span class="line">    <span class="keyword">new</span> CompressionPlugin(&#123;</span><br><span class="line">      test: <span class="regexp">/\.(js|css)$/</span>,<span class="comment">//处理的文件类型</span></span><br><span class="line">      threshold: <span class="number">10240</span>,<span class="comment">//只处理比该值大的资源</span></span><br><span class="line">      minRatio: <span class="number">0.8</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>通过npm 安装webpack-merge，方法：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev webpack-merge</span><br></pre></td></tr></table></figure>
<p>配置npm脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,</span><br><span class="line">  &quot;build&quot;: &quot;webpack --config webpack.build.config.js&quot;,</span><br><span class="line">  &quot;dev&quot;: &quot;webpack-dev-server --config webpack.dev.config.js&quot;,</span><br><span class="line">  &quot;prod&quot;: &quot;webpack --config webpack.prod.config.js&quot;,</span><br><span class="line">  &quot;dev-use-common&quot;: &quot;webpack-dev-server --config webpack.dev.common.config.js&quot;,</span><br><span class="line">  &quot;prod-use-common&quot;: &quot;webpack --config webpack.prod.common.config.js&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行npm run dev-use-common运行开发环境。</p>
<p>执行npm run prod-use-common运行发布环境，生成发布的打包文件。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/01/webpack/" data-id="cjkaxkb990004zsrhb0cb1pxp" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-数据库" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/01/数据库/" class="article-date">
  <time datetime="2018-08-01T09:14:58.000Z" itemprop="datePublished">2018-08-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/01/数据库/">数据库</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="数据库存储引擎"><a href="#数据库存储引擎" class="headerlink" title="数据库存储引擎"></a>数据库存储引擎</h2><p><img src="/2018/08/01/数据库/常用引擎对比.PNG" alt="Alt text"></p>
<h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><p><img src="/2018/08/01/数据库/char和varchar对比.PNG" alt="Alt text"><br>CHAR和VARCHAR的不同之处</p>
<ol>
<li>存储不同，CHAR是分配固定长度存储空间，VARCHAR根据实际字符串长度分配存储空间</li>
<li>对字符串末尾的空格处理不同，CHAR在存储时会删除掉末尾的空格，VARCHAR不会</li>
</ol>
<p>MySQL中不同的存储引擎对CHAR和VARCHAR的使用原则不同<br>  MyISAM：建议使用CHAR代替VARCHAR<br>  MEMORY：无论使用CHAR或VARCHAR，都作为CHAR来处理<br>  InnoDB：建议使用VARCHAR</p>
<h2 id="数据库安全"><a href="#数据库安全" class="headerlink" title="数据库安全"></a>数据库安全</h2><h3 id="SQL注入攻击"><a href="#SQL注入攻击" class="headerlink" title="SQL注入攻击"></a>SQL注入攻击</h3><h4 id="攻击例子："><a href="#攻击例子：" class="headerlink" title="攻击例子："></a>攻击例子：</h4><p>场景：<br>浏览器上输入用户名，显示个人信息<br>查询语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM info_table WHERE name = &apos;user1&apos;</span><br></pre></td></tr></table></figure>
<p>假定用户输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user1&apos;; drop table info_table--</span><br></pre></td></tr></table></figure>
<p>数据库的查询语句将变成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM info_table WHERE name = &apos;user1&apos;; drop table info_table--</span><br></pre></td></tr></table></figure>
<p>分号 (;) 表示一个查询的结束和另一个查询的开始。双连字符 (–) 指示当前行余下的部分是   一个注释，应该忽略。<br>那么该语句将直接把数据库的info_table表删除</p>
<h4 id="防治方法："><a href="#防治方法：" class="headerlink" title="防治方法："></a>防治方法：</h4><ol>
<li>不要直接拼接SQL语句，使用参数化查询来设计数据访问<br>在使用参数化查询的情况下，数据库服务器不会将参数的内容视为SQL指令的一部分来处理，而是在数据库完成SQL指令的编译后，才套用参数运行，因此就算参数中含有具破坏性的指令，也不会被数据库所运行。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> nodejs 为例，可使用？来参数化查询</span><br><span class="line">connection.query(<span class="string">'UPDATE users SET foo = ?, bar = ?, baz = ? WHERE id = ?'</span>, [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, userId], <span class="function"><span class="keyword">function</span> (<span class="params">error, results, fields</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line">  <span class="comment">// ... </span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="number">2.</span> nodejs也提供mysql.escape(), connection.escape() 和 pool.escape()方法来避免SQL注入攻击</span><br><span class="line"><span class="keyword">var</span> userId = <span class="string">'some user provided value'</span>;</span><br><span class="line"><span class="keyword">var</span> sql    = <span class="string">'SELECT * FROM users WHERE id = '</span> + connection.escape(userId);</span><br><span class="line">connection.query(sql, <span class="function"><span class="keyword">function</span> (<span class="params">error, results, fields</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line">  <span class="comment">// ... </span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ol>
<li><p>验证所有输入<br>始终通过测试类型、长度、格式和范围来验证用户输入<br>1）限制输入数据的类型，大小，避免缓冲区溢出<br>2）限制字符串变量的内容<br>3）如果可能，拒绝SQL中的特殊字符</p>
<p>| 特殊字符    | SQL中的含义 |<br>| :—— | :—— |<br>| ;       | 查询分隔符   |<br>| ‘       | 字符串分隔符  |<br>| –      | 注释分隔符   |<br>| /<em>…</em>/ | 注释分隔符   |</p>
</li>
<li><p>​</p>
</li>
<li><p>应用发布之前使用专业检测工具检测，开源工具有sqlmap、SQLninja等</p>
</li>
<li><p>避免将SQL的错误信息打印给外部，防止暴露数据库内部结构</p>
</li>
</ol>
<h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h2><h3 id="登陆"><a href="#登陆" class="headerlink" title="登陆"></a>登陆</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure>
<h3 id="数据库相关操作"><a href="#数据库相关操作" class="headerlink" title="数据库相关操作"></a>数据库相关操作</h3><h4 id="1-显示所有数据库"><a href="#1-显示所有数据库" class="headerlink" title="1. 显示所有数据库"></a>1. 显示所有数据库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br></pre></td></tr></table></figure>
<h4 id="2-切换到指定数据库"><a href="#2-切换到指定数据库" class="headerlink" title="2. 切换到指定数据库"></a>2. 切换到指定数据库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use databaseName;</span><br></pre></td></tr></table></figure>
<h4 id="3-删除指定数据库"><a href="#3-删除指定数据库" class="headerlink" title="3. 删除指定数据库"></a>3. 删除指定数据库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; drop database databaseName;</span><br></pre></td></tr></table></figure>
<h3 id="表相关操作"><a href="#表相关操作" class="headerlink" title="表相关操作"></a>表相关操作</h3><h4 id="1-显示当前数据库中的所有表"><a href="#1-显示当前数据库中的所有表" class="headerlink" title="1. 显示当前数据库中的所有表"></a>1. 显示当前数据库中的所有表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br></pre></td></tr></table></figure>
<h4 id="2-创建表"><a href="#2-创建表" class="headerlink" title="2. 创建表"></a>2. 创建表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table tableName(id varchar(10), name varchar(10));</span><br></pre></td></tr></table></figure>
<h4 id="3-修改表"><a href="#3-修改表" class="headerlink" title="3. 修改表"></a>3. 修改表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table tableName modify name varchar(32);</span><br></pre></td></tr></table></figure>
<h4 id="4-增加表字段"><a href="#4-增加表字段" class="headerlink" title="4. 增加表字段"></a>4. 增加表字段</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table tableName add column sex varchar(10);</span><br></pre></td></tr></table></figure>
<h4 id="5-删除表字段"><a href="#5-删除表字段" class="headerlink" title="5. 删除表字段"></a>5. 删除表字段</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table tableName drop column sex;</span><br></pre></td></tr></table></figure>
<h4 id="6-表字段改名"><a href="#6-表字段改名" class="headerlink" title="6. 表字段改名"></a>6. 表字段改名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table tableName change column name new_name;</span><br></pre></td></tr></table></figure>
<h4 id="5-查看表详细字段及定义"><a href="#5-查看表详细字段及定义" class="headerlink" title="5. 查看表详细字段及定义"></a>5. 查看表详细字段及定义</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc tablename;</span><br></pre></td></tr></table></figure>
<h4 id="6-删除表"><a href="#6-删除表" class="headerlink" title="6. 删除表"></a>6. 删除表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; drop table tableName;</span><br></pre></td></tr></table></figure>
<h3 id="存储引擎相关操作"><a href="#存储引擎相关操作" class="headerlink" title="存储引擎相关操作"></a>存储引擎相关操作</h3><h4 id="1-查看数据库支持的存储引擎"><a href="#1-查看数据库支持的存储引擎" class="headerlink" title="1. 查看数据库支持的存储引擎"></a>1. 查看数据库支持的存储引擎</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show engines;</span><br></pre></td></tr></table></figure>
<h4 id="2-修改存储引擎"><a href="#2-修改存储引擎" class="headerlink" title="2. 修改存储引擎"></a>2. 修改存储引擎</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table tableName engine =engineName;</span><br></pre></td></tr></table></figure>
<h4 id="3-查看某表使用的引擎"><a href="#3-查看某表使用的引擎" class="headerlink" title="3. 查看某表使用的引擎"></a>3. 查看某表使用的引擎</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.通过查看表状态查看</span><br><span class="line">mysql&gt; desc tablename;</span><br><span class="line">2.通过显示表创建语句查看</span><br><span class="line">mysql&gt; show create table tablename;</span><br><span class="line">3.通过显示表的当前状态值查看</span><br><span class="line">mysql&gt; show table status like ‘tablename’\G</span><br></pre></td></tr></table></figure>
<h3 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h3><ol>
<li>创建用户</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE USER &apos;username&apos;@&apos;host&apos; IDENTIFIED BY &apos;password&apos;;</span><br><span class="line">或</span><br><span class="line">mysql&gt; INSERT INTO user(Host,User,Password) values(&apos;host&apos;,&apos;username&apos;,&apos;password&apos;);</span><br></pre></td></tr></table></figure>
<p>在user表Host值的指定方法：<br>Host值可以是主机名或IP号，或’localhost’指出本地主机。<br>你可以在Host列值使用通配符字符“%”和“_”。<br>Host值’%’匹配任何主机名，空Host值等价于’%’。它们的含义与LIKE操作符的模式匹配操作相同。例如，’%’的Host值与所有主机名匹配，而’%.mysql.com’匹配mysql.com域的所有主机。</p>
<p>2.查看用户表（需root用户）<br>用户表信息在mysql的user表中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT User, Host, Password FROM mysql.user;</span><br></pre></td></tr></table></figure>
<p>3.查看用户的权限<br>查看当前用户权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show grants;</span><br></pre></td></tr></table></figure>
<p>查看指定用户权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show grants for &apos;username&apos;@&apos;host&apos;;</span><br></pre></td></tr></table></figure>
<p>4.分配权限<br>格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">GRANT</span><br><span class="line">    priv_type [(column_list)]</span><br><span class="line">      [, priv_type [(column_list)]] ...</span><br><span class="line">    ON [object_type] priv_level</span><br><span class="line">    TO user [auth_option] [, user [auth_option]] ...</span><br><span class="line">    [REQUIRE &#123;NONE | tls_option [[AND] tls_option] ...&#125;]</span><br><span class="line">    [WITH &#123;GRANT OPTION | resource_option&#125; ...]</span><br><span class="line"></span><br><span class="line">GRANT PROXY ON user</span><br><span class="line">    TO user [, user] ...</span><br><span class="line">    [WITH GRANT OPTION]</span><br><span class="line"></span><br><span class="line">object_type: &#123;</span><br><span class="line">    TABLE</span><br><span class="line">  | FUNCTION</span><br><span class="line">  | PROCEDURE</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">priv_level: &#123;</span><br><span class="line">    *</span><br><span class="line">  | *.*</span><br><span class="line">  | db_name.*</span><br><span class="line">  | db_name.tbl_name</span><br><span class="line">  | tbl_name</span><br><span class="line">  | db_name.routine_name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">user:</span><br><span class="line">    (see Section 6.2.3, “Specifying Account Names”)</span><br><span class="line"></span><br><span class="line">auth_option: &#123;</span><br><span class="line">    IDENTIFIED BY &apos;auth_string&apos;</span><br><span class="line">  | IDENTIFIED WITH auth_plugin</span><br><span class="line">  | IDENTIFIED WITH auth_plugin BY &apos;auth_string&apos;</span><br><span class="line">  | IDENTIFIED WITH auth_plugin AS &apos;hash_string&apos;</span><br><span class="line">  | IDENTIFIED BY PASSWORD &apos;hash_string&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tls_option: &#123;</span><br><span class="line">    SSL</span><br><span class="line">  | X509</span><br><span class="line">  | CIPHER &apos;cipher&apos;</span><br><span class="line">  | ISSUER &apos;issuer&apos;</span><br><span class="line">  | SUBJECT &apos;subject&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource_option: &#123;</span><br><span class="line">  | MAX_QUERIES_PER_HOUR count</span><br><span class="line">  | MAX_UPDATES_PER_HOUR count</span><br><span class="line">  | MAX_CONNECTIONS_PER_HOUR count</span><br><span class="line">  | MAX_USER_CONNECTIONS count</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>格式为：<br>grant 权限 on 数据库对象 to 用户<br>详细参见：<br><a href="https://dev.mysql.com/doc/refman/5.7/en/grant.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.7/en/grant.html</a></p>
<p>例子：<br>1）给user1配置test数据库的查询，插入权限（允许user1对test数据库的所有表进行查询插入）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; GRANT SELECT INSERT on test.* to &apos;user1&apos;@&apos;%&apos;;</span><br></pre></td></tr></table></figure>
<p>2）给user1配置test数据库table1的查询，插入权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; GRANT SELECT INSERT on test.table1 to &apos;user1&apos;@&apos;%&apos;;</span><br></pre></td></tr></table></figure>
<p>5.回收权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">REVOKE</span><br><span class="line">    priv_type [(column_list)]</span><br><span class="line">      [, priv_type [(column_list)]] ...</span><br><span class="line">    ON [object_type] priv_level</span><br><span class="line">    FROM user [, user] ...</span><br><span class="line"></span><br><span class="line">REVOKE ALL [PRIVILEGES], GRANT OPTION</span><br><span class="line">    FROM user [, user] ...</span><br><span class="line"></span><br><span class="line">REVOKE PROXY ON user</span><br><span class="line">    FROM user [, user] ...</span><br></pre></td></tr></table></figure>
<p>格式为：<br>REVOKE 权限 on 数据库对象 to 用户</p>
<p>例子：<br>回收user1 的所有delete权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; REVOKE DELETE on *.* from &apos;user1&apos;@&apos;%&apos;;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/01/数据库/" data-id="cjkaxkb9b0006zsrhk7f4lobq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-EMQ安装与配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/26/EMQ安装与配置/" class="article-date">
  <time datetime="2018-07-26T01:53:34.000Z" itemprop="datePublished">2018-07-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/26/EMQ安装与配置/">EMQ安装与配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="MQTT简介"><a href="#MQTT简介" class="headerlink" title="MQTT简介"></a>MQTT简介</h1><ol>
<li>基于二进制消息的发布/订阅模式的消息协议</li>
<li>适合需要低功耗和网络带宽有限的IoT场景：<ul>
<li>遥感数据、汽车、智能家居、智慧城市、医疗医护</li>
</ul>
</li>
</ol>
<h1 id="MQTT对比"><a href="#MQTT对比" class="headerlink" title="MQTT对比"></a>MQTT对比</h1><table>
<thead>
<tr>
<th>server</th>
<th>性能</th>
<th>收费</th>
<th>集群</th>
</tr>
</thead>
<tbody>
<tr>
<td>mosquitto</td>
<td>测试例子7000左右</td>
<td>开源免费</td>
<td>不支持</td>
</tr>
<tr>
<td>HiveMQ</td>
<td>支持到千万级  亚毫秒级的延迟  高吞吐量</td>
<td>根据设备数收费</td>
<td>支持</td>
</tr>
<tr>
<td>VerneMQ</td>
<td>支持百万级</td>
<td>开源免费</td>
<td>无主集群技术</td>
</tr>
<tr>
<td>emqttd（EMQ）</td>
<td>支持单节点100万连接  毫秒级低时延</td>
<td>开源免费</td>
<td>分布式集群</td>
</tr>
</tbody>
</table>
<p>emqttd和VerneMQ：</p>
<p>性能上相差不大，都是基于Erlang/OTP分布式编程</p>
<p>emqttd当前有已知的稳定的应用（ZAKER新闻客户端）</p>
<h1 id="EMQ安装及配置"><a href="#EMQ安装及配置" class="headerlink" title="EMQ安装及配置"></a>EMQ安装及配置</h1><p>##下载路径</p>
<p><a href="http://emqtt.com/downloads" target="_blank" rel="noopener">http://</a><a href="http://emqtt.com/downloads" target="_blank" rel="noopener">emqtt.com/downloads</a></p>
<h2 id="启动方法"><a href="#启动方法" class="headerlink" title="启动方法"></a>启动方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">unzip emqttd-ubuntu14.04-v2.2.0.zip</span><br><span class="line">cd emqttds</span><br><span class="line">sudo ./bin/emqttd start</span><br></pre></td></tr></table></figure>
<p>##配置</p>
<p>EMQ2.0消息服务器通过etc/目录下配置文件进行设置，</p>
<p>主要配置文件包括:</p>
<ol>
<li>etc/emq.conf            —&gt;   EMQ 消息服务器配置文件</li>
<li>etc/acl.conf               —&gt;   EMQ 默认ACL规则配置文件</li>
<li>etc/plugins/*.conf   —&gt;   EMQ 各类插件配置文件</li>
</ol>
<p>日志参数配置</p>
<p><img src="/2018/07/26/EMQ安装与配置/log.png" alt="log"></p>
<h3 id="未完待续……"><a href="#未完待续……" class="headerlink" title="未完待续……"></a>未完待续……</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/26/EMQ安装与配置/" data-id="cjkaxkb8y0000zsrhplbk84lx" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-bbs调试及修改文章显示小结" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/26/bbs调试及修改文章显示小结/" class="article-date">
  <time datetime="2018-07-26T01:25:10.000Z" itemprop="datePublished">2018-07-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/26/bbs调试及修改文章显示小结/">bbs调试及修改文章显示小结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><ol>
<li>bbs编辑完成发表时，会发现实际显示的样式和编辑时的样式有差别</li>
<li>复制markdown文档到bbs编辑器中，发表后显示的效果与markdown中不一致，会存在代码段换行失效问题</li>
</ol>
<p>主要针对这些问题进行bbs显示的优化。</p>
<h2 id="调试方法"><a href="#调试方法" class="headerlink" title="调试方法"></a>调试方法</h2><p>bbs采用的是weCenter, weCenter可以在配置文件中开启网站的debug模式，然后通过debug函数输出信息到页面的最下角以供调试</p>
<p>配置文件路径为：在bbs目录下的<code>system\config\system.php</code>文件中。</p>
<p>具体修改如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$config[<span class="string">'debug'</span>] = <span class="keyword">true</span>;	<span class="comment">// 开启网站 Debug 模式</span></span><br></pre></td></tr></table></figure>
<p>打开该配置后，会有一些系统的默认调试信息输出在页面最底部。</p>
<p>如果需要打印其他调试信息，使用<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```php</span><br><span class="line">	/**</span><br><span class="line">	 * 记录系统 Debug 事件</span><br><span class="line">	 *</span><br><span class="line">	 * 打开 debug 功能后相应事件会在页脚输出</span><br><span class="line">	 *</span><br><span class="line">	 * @access	public</span><br><span class="line">	 * @param	string</span><br><span class="line">	 * @param	string</span><br><span class="line">	 * @param	string</span><br><span class="line">	 */</span><br><span class="line">	public static function debug_log($type, $expend_time, $message)</span><br><span class="line">	&#123;</span><br><span class="line">		self::$_debug[$type][] = array(</span><br><span class="line">			&apos;expend_time&apos; =&gt; $expend_time,</span><br><span class="line">			&apos;log_time&apos; =&gt; microtime(true),</span><br><span class="line">			&apos;message&apos; =&gt; $message</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>对于粘贴过来的markdown文档，发表时，存储在数据库中的数据与复制到编辑框中的数据是一样的，只是显示时是将从数据库读出来的文章内容放在pre标签中显示出来，而在<code>static\css\default\common.css</code>中设置了：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.markitup-box</span> <span class="selector-tag">pre</span> <span class="selector-tag">br</span>, <span class="selector-class">.markitup-box</span> <span class="selector-tag">ul</span> + <span class="selector-tag">br</span>, <span class="selector-class">.markitup-box</span> <span class="selector-tag">ol</span> + <span class="selector-tag">br</span> &#123;<span class="attribute">display</span>: none;&#125;</span><br></pre></td></tr></table></figure>
<p>而markdown中的代码段是使用br来换行的，这个导致了markdown文档中的代码段换行无法显示。</p>
<p>由于pre标签显示markdown表格等也有问题，而编辑的时候使用的是ueditor工具，该工具对markdown文档的支持良好，最终决定将文章的pre显示方式换成使用编辑工具ueditor显示。</p>
<h2 id="使用ueditor显示"><a href="#使用ueditor显示" class="headerlink" title="使用ueditor显示"></a>使用ueditor显示</h2><p>ueditor使用方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化编辑器，将id=wmd-input的标签内容作为ueditor的显示内容</span></span><br><span class="line"><span class="keyword">var</span> editor = UE.getEditor(<span class="string">'wmd-input'</span>);</span><br><span class="line"><span class="comment">//对编辑器的操作最好在编辑器ready之后再做</span></span><br><span class="line">editor.ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="comment">//TODO</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>使用配置文件对ueditor进行配置，配置文件为<code>ueditor.config.js</code>，里面列出了可配置项，可自由配置。</p>
<p>还可以使用命令对ueditor进行配置。如<code>editor.setDisabled()</code>是禁用ueditor的所有编辑功能，这在显示时需要设置。</p>
<h3 id="具体步骤"><a href="#具体步骤" class="headerlink" title="具体步骤"></a>具体步骤</h3><p><strong>步骤1：</strong></p>
<p>显示的html文件是<code>views\default\article\index.tpl.htm</code>，</p>
<p>修改</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;article_info[<span class="string">'message'</span>]; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>为：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;textarea class="wmd-input editor" id="wmd-input" rows="15" name="question_detail"&gt;</span><br><span class="line">	<span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;article_info[<span class="string">'message'</span>]; <span class="meta">?&gt;</span></span><br><span class="line">&lt;/textarea&gt;</span><br></pre></td></tr></table></figure>
<p><strong>步骤2：</strong></p>
<p>在<code>static\js\app</code>路径下增加<code>article.js</code>来调用ueditor编辑器。为了优化显示效果，在文章显示时，去掉了ueditor默认的边框以及增加了url跳转处理。</p>
<p><code>article.js</code>代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">		<span class="comment">// 初始化编辑器</span></span><br><span class="line">		<span class="keyword">var</span> editor = UE.getEditor(<span class="string">'wmd-input'</span>);</span><br><span class="line">		<span class="comment">//对编辑器的操作最好在编辑器ready之后再做</span></span><br><span class="line">		editor.ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			editor.setDisabled();</span><br><span class="line"></span><br><span class="line">			<span class="comment">//去掉ueditor边框和编辑框</span></span><br><span class="line">			$(<span class="string">'#edui1'</span>).css(<span class="string">'border-style'</span>, <span class="string">'none'</span>);</span><br><span class="line">			$(<span class="string">'#edui1_toolbarbox'</span>).css(<span class="string">'display'</span>, <span class="string">'none'</span>);</span><br><span class="line">			$(<span class="string">'#edui1_bottombar'</span>).css(<span class="string">'display'</span>, <span class="string">'none'</span>);</span><br><span class="line"></span><br><span class="line">			<span class="comment">//将iframe中的超链接都在新标签页中打开</span></span><br><span class="line">			<span class="keyword">var</span> iframs = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'iframe'</span>);</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; iframs.length; i++) &#123;</span><br><span class="line">				<span class="keyword">var</span> ifrm = iframs[i];</span><br><span class="line">				<span class="keyword">var</span> head;</span><br><span class="line">				<span class="keyword">if</span> (ifrm.contentWindow)</span><br><span class="line">				&#123;</span><br><span class="line">					head = ifrm.contentWindow.document.head;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">					head = ifrm.contentDocument.document.head;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (head) &#123;</span><br><span class="line">					<span class="keyword">var</span> base = <span class="built_in">document</span>.createElement(<span class="string">'base'</span>);</span><br><span class="line">					base.target = <span class="string">"_blank"</span>;</span><br><span class="line">					head.appendChild(base);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>步骤3</strong></p>
<p>在<code>app/article/main.php</code>中index_action()函数中增加，当在请求文章内容时，便会加载<code>article.js</code>脚本和<code>ueditor</code>库文件。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index_action</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ($_GET[<span class="string">'notification_id'</span>])</span><br><span class="line">  &#123;</span><br><span class="line">  	<span class="keyword">$this</span>-&gt;model(<span class="string">'notify'</span>)-&gt;read_notification($_GET[<span class="string">'notification_id'</span>], <span class="keyword">$this</span>-&gt;user_id);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (is_mobile())</span><br><span class="line">  &#123;</span><br><span class="line">  	HTTP::redirect(<span class="string">'/m/article/'</span> . $_GET[<span class="string">'id'</span>]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (! $article_info = <span class="keyword">$this</span>-&gt;model(<span class="string">'article'</span>)-&gt;get_article_info_by_id($_GET[<span class="string">'id'</span>]))</span><br><span class="line">  &#123;</span><br><span class="line">  	HTTP::error_404();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> + TPL::import_js(<span class="string">'js/app/article.js'</span>);</span><br><span class="line"> + import_editor_static_files();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ($article_info[<span class="string">'has_attach'</span>])</span><br><span class="line">  &#123;</span><br><span class="line">  	$article_info[<span class="string">'attachs'</span>] = <span class="keyword">$this</span>-&gt;model(<span class="string">'publish'</span>)-&gt;get_attach(<span class="string">'article'</span>, $article_info[<span class="string">'id'</span>], <span class="string">'min'</span>);</span><br><span class="line"></span><br><span class="line">  	$article_info[<span class="string">'attachs_ids'</span>] = FORMAT::parse_attachs($article_info[<span class="string">'message'</span>], <span class="keyword">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>至此，使用ueditor来显示文章内容已经完成</p>
<h3 id="小细节优化"><a href="#小细节优化" class="headerlink" title="小细节优化"></a>小细节优化</h3><p>在测试中发现，使用ueditor编辑器显示文章时，不会将很长的一行的代码自动换行，文章中的图片宽度会超过显示的宽度。</p>
<p>于是通过在<code>static\ueditor1_4_3_3\themes\iframe.css</code>增加自定义的CSS样式来实现显示的优化，如下：</p>
<p><code>iframe.css</code>文件:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*可以在这里添加你自己的css*/</span></span><br><span class="line"><span class="selector-tag">span</span>, <span class="selector-tag">pre</span>&#123;</span><br><span class="line">        <span class="attribute">white-space</span>: pre-wrap</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">span</span>&#123;</span><br><span class="line">        <span class="attribute">max-width</span>: <span class="number">100%</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">img</span>&#123;</span><br><span class="line">        <span class="attribute">max-width</span>:<span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还需要在ueditor的配置文件中打开<code>iframeCssUrl</code>配置，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">//如果自定义，最好给p标签如下的行高，要不输入中文时，会有跳动感</span></span><br><span class="line"><span class="comment">//,initialStyle:'p&#123;line-height:1em&#125;'//编辑器层级的基数,可以用来改变字体等</span></span><br><span class="line"></span><br><span class="line">,<span class="attr">iframeCssUrl</span>: URL + <span class="string">'/themes/iframe.css'</span> <span class="comment">//给编辑区域的iframe引入一个css文件</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>另，在测试过程中发现输入长文章会被截断，原因是文章内容在MySQL中存储时，使用的数据类型是TEXT，最多支持64KB的数据量，改为MEDIUMTEXT后就解决了该问题。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/26/bbs调试及修改文章显示小结/" data-id="cjkaxkb9c0007zsrhkkxt519i" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-promise" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/26/promise/" class="article-date">
  <time datetime="2018-07-26T01:16:36.000Z" itemprop="datePublished">2018-07-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/26/promise/">promise</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>javascript是异步单线程的，所有操作的返回结果都是在回调函数中进行处理。</p>
<p>所以对于依赖于上一步处理的结果进行下一步处理的情况，就会存在回调函数的多层嵌套，其可读性也会随着嵌套的增多而变差。如下所示</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">functionA(para, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">    functionB(para, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">        functionC(para, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">            functionD(para, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">                ...</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>而ES6提供了promise来供我们处理这种链式情况，使代码的可读性更好，并可以用异步的方式来处理同步问题。</p>
<h2 id="简单的promise的使用"><a href="#简单的promise的使用" class="headerlink" title="简单的promise的使用"></a>简单的promise的使用</h2><p>例1</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> promise1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">	setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> num = <span class="built_in">Math</span>.round(<span class="built_in">Math</span>.random() * <span class="number">10</span>);</span><br><span class="line">		<span class="keyword">if</span> (num &lt; <span class="number">5</span>) &#123;</span><br><span class="line">			resolve(num);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			reject(num);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(promise1);</span><br><span class="line">promise1.then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'res:'</span> + res);</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'err:'</span> + err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当产生的随机数大于等于5时，返回结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Promise &#123; &lt;pending&gt; &#125;</span><br><span class="line">err:9</span><br></pre></td></tr></table></figure>
<p>当产生的随机数小于5时，返回结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Promise &#123; &lt;pending&gt; &#125;</span><br><span class="line">res:3</span><br></pre></td></tr></table></figure>
<p>例2</p>
<p>去掉上例中的<code>setTimeout</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> promise1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> num = <span class="built_in">Math</span>.round(<span class="built_in">Math</span>.random() * <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">if</span> (num &lt; <span class="number">5</span>) &#123;</span><br><span class="line">      resolve(num);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      reject(num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(promise1);</span><br><span class="line">promise1.then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'res:'</span> + res);</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'err:'</span> + err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当产生的随机数大于等于5时，返回结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span> &#123; &lt;rejected&gt; <span class="number">7</span> &#125;</span><br><span class="line">err:<span class="number">7</span></span><br></pre></td></tr></table></figure>
<p>当产生的随机数小于5时，返回结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span> &#123; <span class="number">4</span> &#125;</span><br><span class="line">res:<span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>例1和例2中如果随机数小于5，就会调用<code>resolve</code>函数，返回num的值，否则，就会调用<code>reject</code>函数返回num的值。</p>
<p>调用<code>Promise</code>后，通过<code>.then</code>来对<code>resolve</code>函数的结果进行处理，通过<code>.catch</code>来对<code>reject</code>函数返回的错误进行处理。</p>
<p>例1和例2<code>Promise</code>对象的状态不一样，后续在规则语法中说明。</p>
<h2 id="promise语法规则"><a href="#promise语法规则" class="headerlink" title="promise语法规则"></a>promise语法规则</h2><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>( <span class="comment">/* executor */</span> <span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123; ... &#125; );</span><br></pre></td></tr></table></figure>
<p><code>Promise</code>对象有两个参数<code>resolve</code>和<code>reject</code>。执行器（executor）通常开始一些异步的工作，当异步的工作处理完成后，处理成功则调用<code>resolve</code>函数来解决该<code>promise</code>，发生错误则调用<code>reject</code>拒绝该<code>promise</code>。</p>
<p><code>Promise</code>有三种状态：</p>
<ul>
<li>pending: 初始状态</li>
<li>fulfilled: 操作成功执行</li>
<li>rejected: 操作执行失败</li>
</ul>
<p>从上例的打印可以看到pending和rejected状态。执行成功时返回的fulfilled状态并未在打印中明显体现出来。</p>
<p>fulfilled状态是在<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise中说明的，很多博客上写的该状态叫resolved。称呼不一样，表征的状态是一致的。" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise中说明的，很多博客上写的该状态叫resolved。称呼不一样，表征的状态是一致的。</a></p>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><h4 id="Promise-resolve-value"><a href="#Promise-resolve-value" class="headerlink" title="Promise.resolve(value)"></a><code>Promise.resolve(value)</code></h4><p>返回一个resolved的Promise对象，可以直接使用<code>.then</code>方法进行后续处理。如<code>Promise.resolve(5).then(function(res){console.log(res)})</code>。</p>
<h4 id="Promise-reject-reason"><a href="#Promise-reject-reason" class="headerlink" title="Promise.reject(reason)"></a><code>Promise.reject(reason)</code></h4><p>返回一个rejected的Promise对象，可以直接使用<code>.catch</code>方法进行错误处理。</p>
<h4 id="Promise-all-iterable"><a href="#Promise-all-iterable" class="headerlink" title="Promise.all(iterable)"></a><code>Promise.all(iterable)</code></h4><p>该方法也返回一个Promise的对象。该方法可以用于多个promise的并行处理，对多个Promise进行处理，输入参数为多个Promise组成的数组，调用Promise.all后，输入的所有Promise都是异步执行，当输入的所有promise都成功执行（fulfilled状态）后，该Promise才成功执行（fulfilled状态）。一旦有一个Promise执行失败（rejected状态），该Promise直接转到失败状态（rejected状态）。</p>
<p>语言描述的有点绕，直接看例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> promise1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">	setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'promise1'</span>);</span><br><span class="line">		resolve(<span class="number">1</span>);</span><br><span class="line">	&#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'promise2'</span>);</span><br><span class="line">		resolve(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> promise3 = <span class="string">'3'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> promise4 = <span class="built_in">Promise</span>.reject(<span class="string">'promise4 error'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all([promise1, promise2]).then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'-&gt;test [promise1, promise2] result:'</span>);	</span><br><span class="line">	<span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'-&gt;test [promise1, promise2] err:'</span> + err);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all([promise3, promise4]).then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'-&gt;test [promise3, promise4] result:'</span>);	</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'-&gt;test [promise3, promise4] err:'</span> + err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>返回结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">promise2</span><br><span class="line">-&gt;test [promise3, promise4] err:promise4 error</span><br><span class="line">promise1</span><br><span class="line">-&gt;test [promise1, promise2] result:</span><br><span class="line">[ <span class="number">1</span>, <span class="number">2</span> ]</span><br></pre></td></tr></table></figure>
<p><code>Promise.all</code>接收一个promise数组，等待数组全部处理完成的结果，一旦某一个promise发生错误，即刻返回错误。</p>
<p>从执行结果可以看出，在Promise.all([promise1, promise2])中，promise1的执行在promise2之后，也充分说明promise数组中的所有promise是异步执行的。</p>
<p>Promise.all执行成功后返回的值是数组，数组值与输入参数数组中的promise一一对应，为每个promise成功执行后的返回值。</p>
<p>在Promise.all([promise3, promise4])中，promise4返回rejected，Promise.all也立即返回rejected。</p>
<h4 id="Promise-race-iterable"><a href="#Promise-race-iterable" class="headerlink" title="Promise.race(iterable)"></a><code>Promise.race(iterable)</code></h4><p>返回一个promise对象。该方法接受输入参数为promise数组，当promise数组中有一个最先resolved或是rejected，则该方法立即返回resolved或是rejected的Promise对象。</p>
<p>例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> promise1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">	setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		reject(<span class="string">'promise1'</span>);</span><br><span class="line">	&#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> promise2 = <span class="built_in">Promise</span>.resolve(<span class="string">'promise2'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.race([promise1, promise2]).then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'-&gt;test race result:'</span>);	</span><br><span class="line">	<span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'-&gt;test race err:'</span> + err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>返回结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-&gt;test race result:</span><br><span class="line">promise2</span><br></pre></td></tr></table></figure>
<p>如上所示，当promise2执行完成后，直接返回promise2的结果。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/26/promise/" data-id="cjkaxkb9k0008zsrh6k7lit43" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/27/hello-world/" class="article-date">
  <time datetime="2018-04-27T02:01:08.379Z" itemprop="datePublished">2018-04-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/27/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/27/hello-world/" data-id="cjkaxkb950002zsrh45c2h2v8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/08/01/mysql备份/">mysql备份与恢复</a>
          </li>
        
          <li>
            <a href="/2018/08/01/nodejs通过child_process.exec调用shell脚本/">nodejs通过child_process.exec调用shell脚本</a>
          </li>
        
          <li>
            <a href="/2018/08/01/数据库全局主键生成策略/">数据库全局主键生成策略</a>
          </li>
        
          <li>
            <a href="/2018/08/01/webpack/">webpack</a>
          </li>
        
          <li>
            <a href="/2018/08/01/数据库/">数据库</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 shelly liu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>